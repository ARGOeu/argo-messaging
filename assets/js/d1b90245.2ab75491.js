"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3602],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),p=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=p(e.components);return a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,c=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,h=d["".concat(c,".").concat(m)]||d[m]||u[m]||s;return n?a.createElement(h,i(i({ref:t},l),{},{components:n})):a.createElement(h,i({ref:t},l))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,i=new Array(s);i[0]=d;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var p=2;p<s;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8765:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const s={id:"projects_users",title:"Initial Project & User Management"},i=void 0,o={unversionedId:"concepts/projects_users",id:"concepts/projects_users",title:"Initial Project & User Management",description:"This document describes some of the more advanced setup you may need to do while configuring and deploying the ARGO Messaging Service.",source:"@site/docs/concepts/projects_users.md",sourceDirName:"concepts",slug:"/concepts/projects_users",permalink:"/argo-messaging/docs/concepts/projects_users",draft:!1,tags:[],version:"current",frontMatter:{id:"projects_users",title:"Initial Project & User Management"},sidebar:"tutorialSidebar",previous:{title:"Overview & Introduction",permalink:"/argo-messaging/docs/concepts/overview"},next:{title:"Guides",permalink:"/argo-messaging/docs/category/guides"}},c={},p=[{value:"A typical quick-start scenario",id:"a-typical-quick-start-scenario",level:2},{value:"Configure <code>service_token</code>",id:"configure-service_token",level:2},{value:"Create a service_admin user",id:"create-a-service_admin-user",level:2},{value:"Create a project",id:"create-a-project",level:2},{value:"Create a project_admin",id:"create-a-project_admin",level:2},{value:"Create a topic",id:"create-a-topic",level:2},{value:"Create a subscription",id:"create-a-subscription",level:2},{value:"Create users for the new resources",id:"create-users-for-the-new-resources",level:2},{value:"Modify topic ACL to give access to publisher",id:"modify-topic-acl-to-give-access-to-publisher",level:3},{value:"Modify subscription ACL to give access to consumer",id:"modify-subscription-acl-to-give-access-to-consumer",level:3}],l={toc:p};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This document describes some of the more advanced setup you may need to do while configuring and deploying the ARGO Messaging Service."),(0,r.kt)("h2",{id:"a-typical-quick-start-scenario"},"A typical quick-start scenario"),(0,r.kt)("p",null,"After a fresh install of the ARGO Messaging Service, the steps you need to follow are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Configure ",(0,r.kt)("inlineCode",{parentName:"li"},"service_token"),": to enable the service."),(0,r.kt)("li",{parentName:"ul"},"Create a service_admin user: to start managing the service."),(0,r.kt)("li",{parentName:"ul"},"Create a project: Project entities is used as a basis of organizing and isolating groups of users & resources"),(0,r.kt)("li",{parentName:"ul"},"Create a project_admin user: Users that have the project_admin have, by default, all capabilities in their project. They can also manage resources such as topics and subscriptions (CRUD) and also manage ACLs (users) on those resources as well."),(0,r.kt)("li",{parentName:"ul"},"Create a topic: The main resource that is scoped in a project, and can hold messages."),(0,r.kt)("li",{parentName:"ul"},"Create a subscription: A subscription is the main resource from which users consume messages."),(0,r.kt)("li",{parentName:"ul"},"Create users for the new resources: Usually a project has  publisher and consumer accounts for clients that either are authorized to publish or consume messages.")),(0,r.kt)("h2",{id:"configure-service_token"},"Configure ",(0,r.kt)("inlineCode",{parentName:"h2"},"service_token")),(0,r.kt)("p",null,"ARGO Messaging Service configuration includes the ",(0,r.kt)("inlineCode",{parentName:"p"},"service_token")," parameter. This ",(0,r.kt)("inlineCode",{parentName:"p"},"service_token")," configuration parameter can be used to create the first ",(0,r.kt)("inlineCode",{parentName:"p"},"service_admin")," user of the service"),(0,r.kt)("p",null,"First a service token must be defined in the config.json as such:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "bind_ip":"",\n  "port":8080,\n  "zookeeper_hosts":["localhost"],\n  "kafka_znode":"",\n  "store_host":"localhost",\n  "store_db":"argo_msg",\n  "certificate":"/etc/pki/tls/certs/localhost.crt",\n  "certificate_key":"/etc/pki/tls/private/localhost.key",\n  "per_resource_auth":"true",\n  "service_token":"S3CR3T",\n  "push_enabled": false\n}\n')),(0,r.kt)("p",null,"The service token in this example has the value: ",(0,r.kt)("inlineCode",{parentName:"p"},"S3CR3T"),"\nThis ",(0,r.kt)("inlineCode",{parentName:"p"},"service_token")," is authorized for all available actions (projects,users,topics,subscriptions)."),(0,r.kt)("p",null,"In order to enable the use of this ",(0,r.kt)("inlineCode",{parentName:"p"},"service_token")," you must restart the service."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"service argo-messaging restart\n")),(0,r.kt)("h2",{id:"create-a-service_admin-user"},"Create a service_admin user"),(0,r.kt)("p",null,"The service_token is intended to be used for the first initialization of the API. The first thing the service needs is a user with all possible capabilities, which is a ",(0,r.kt)("inlineCode",{parentName:"p"},"service_admin"),".\nNow even though no user has been initialized in the service, the administrator can use the ARGO Messaging API Call with service_token ",(0,r.kt)("inlineCode",{parentName:"p"},"S3CR3T")," to create the user.\nThe service_admin will be able to further define projects and other users."),(0,r.kt)("p",null,"Using the service_token an admin can create a new service_admin user with the username ",(0,r.kt)("inlineCode",{parentName:"p"},"demo_service_admin")," by calling:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST https://{URL}/v1/users/demo_service_admin?key=S3CR3T\n")),(0,r.kt)("p",null,"with the following POST BODY:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "email":"sadmin@mail.example.foo",\n   "service_roles":["service_admin"]\n}\n')),(0,r.kt)("p",null,"It is important to mention that the user has the ",(0,r.kt)("strong",{parentName:"p"},'"service_admin"')," role defined in the service_roles list in order to be a service_admin."),(0,r.kt)("p",null,"The response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "projects": [],\n  "name": "demo_service_admin",\n  "token": "904c56cc6e2b1955dbd98ace80a45be8238432fc",\n  "email": "sadmin@mail.example.foo",\n  "service_roles": [\n    "service_admin"\n  ],\n  "created_on": "2016-10-13T11:19:07Z",\n  "modified_on": "2016-10-13T11:19:07Z"\n}\n')),(0,r.kt)("p",null,"The generated token ",(0,r.kt)("inlineCode",{parentName:"p"},"904c56cc6e2b1955dbd98ace80a45be8238432fc")," can be used to authenticate the new user.\nFor more details visit the ",(0,r.kt)("a",{parentName:"p",href:"/argo-messaging/docs/api_advanced/api_users"},"API Users")," to see all possible actions for users."),(0,r.kt)("h2",{id:"create-a-project"},"Create a project"),(0,r.kt)("p",null,"Using the ",(0,r.kt)("inlineCode",{parentName:"p"},"demo_service_admin")," account, the user can create the first project (ex named 'DEMO') by issuing:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST https://{URL}/v1/projects/DEMO?key=904c56cc6e2b1955dbd98ace80a45be8238432fc\n")),(0,r.kt)("p",null,"with the following POST BODY:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "description":"my first demo project"\n}\n')),(0,r.kt)("p",null,"and the response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "DEMO",\n  "created_on": "2016-10-13T12:19:07Z",\n  "modified_on": "2016-10-13T12:19:07Z",\n  "created_by": "demo_service_admin",\n  "description": "my first demo project"\n}\n')),(0,r.kt)("p",null,"Response informs that the project has been indeed ",(0,r.kt)("inlineCode",{parentName:"p"},"created_by")," the ",(0,r.kt)("inlineCode",{parentName:"p"},"demo_service_admin")," user."),(0,r.kt)("p",null,"For more details visit the ",(0,r.kt)("a",{parentName:"p",href:"/argo-messaging/docs/api_advanced/api_projects"},"API Projects")," to see all possible actions for projects."),(0,r.kt)("h2",{id:"create-a-project_admin"},"Create a project_admin"),(0,r.kt)("p",null,"Service_admin users are not attached to specific projects. Instead each project should have a ",(0,r.kt)("inlineCode",{parentName:"p"},"project_admin")," user that will manage topics, subscriptions and ACLs on those resources. To create a ",(0,r.kt)("inlineCode",{parentName:"p"},"project_admin")," user in project ",(0,r.kt)("inlineCode",{parentName:"p"},"DEMO"),", the user ",(0,r.kt)("inlineCode",{parentName:"p"},"demo_service_admin")," will issue:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST https://{URL}/v1/users/admin_DEMO?key=904c56cc6e2b1955dbd98ace80a45be8238432fc\n")),(0,r.kt)("p",null,"with the following POST BODY:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "email":"demoadmin@mail.example.foo",\n   "projects":[{"project":"DEMO","roles":["project_admin"]}]\n}\n')),(0,r.kt)("p",null,"The user definition (in POST body) should have the field ",(0,r.kt)("inlineCode",{parentName:"p"},"projects")," defined. The field accepts a list of tuple items (project,roles) which describe each project that the user participates to and under which roles. A user can have multiple roles in a project and also participate in multiple projects as well. In this example, the user must participate in project ",(0,r.kt)("inlineCode",{parentName:"p"},"DEMO")," and under the role of ",(0,r.kt)("inlineCode",{parentName:"p"},"project_admin"),"."),(0,r.kt)("p",null,"The response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "projects": [\n    {\n      "project": "DEMO",\n      "roles": [\n        "project_admin"\n      ]\n    }\n  ],\n  "name": "admin_DEMO",\n  "token": "6311196665befcc1523b8e013979347b8780254c",\n  "email": "demoadmin@mail.example.foo",\n  "service_roles": [],\n  "created_on": "2016-10-13T12:29:07Z",\n  "modified_on": "2016-10-13T12:29:07Z",\n  "created_by": "demo_service_admin"\n}\n')),(0,r.kt)("p",null,"For more details visit the ",(0,r.kt)("a",{parentName:"p",href:"/argo-messaging/docs/api_advanced/api_users"},"API Users")," to see all possible actions for users."),(0,r.kt)("h2",{id:"create-a-topic"},"Create a topic"),(0,r.kt)("p",null,"Service_admin users don't manage resources such as topics/subscriptions. Instead in each project the project_admin is eligible for creating (and managing) topics and subscriptions. To create a new topic (named ",(0,r.kt)("inlineCode",{parentName:"p"},"topic101"),") as ",(0,r.kt)("inlineCode",{parentName:"p"},"admin_DEMO")," user in project ",(0,r.kt)("inlineCode",{parentName:"p"},"DEMO")," the user issues:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"PUT https://{URL}/v1/projects/DEMO/topics/topic101?key=6311196665befcc1523b8e013979347b8780254c\n")),(0,r.kt)("p",null,"with response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "name": "/projects/DEMO/topics/topic101"\n}\n')),(0,r.kt)("p",null,"Notice that the token used in api ",(0,r.kt)("inlineCode",{parentName:"p"},"key")," changes to that of the ",(0,r.kt)("inlineCode",{parentName:"p"},"admin_DEMO")," user"),(0,r.kt)("p",null,"For more details visit the ",(0,r.kt)("a",{parentName:"p",href:"/argo-messaging/docs/api_advanced/api_topics"},"API Topics")," to see all possible actions for topics."),(0,r.kt)("h2",{id:"create-a-subscription"},"Create a subscription"),(0,r.kt)("p",null,"To create a new subscription (named ",(0,r.kt)("inlineCode",{parentName:"p"},"sub101"),") to topic ",(0,r.kt)("inlineCode",{parentName:"p"},"topic101")," of project ",(0,r.kt)("inlineCode",{parentName:"p"},"DEMO")," the ",(0,r.kt)("inlineCode",{parentName:"p"},"admin_DEMO")," user issues:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"PUT https://{URL}/v1/projects/DEMO/subscriptions/subs101?key=6311196665befcc1523b8e013979347b8780254c\n")),(0,r.kt)("p",null,"with POST Body:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "topic":"projects/DEMO/topic/topic101"\n}\n')),(0,r.kt)("p",null,"and response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "/projects/DEMO/subscriptions/sub101",\n  "topic": "/projects/DEMO/topics/topic101",\n  "pushConfig": {\n    "pushEndpoint": "",\n    "retryPolicy": {}\n  },\n  "ackDeadlineSeconds": 10\n}\n')),(0,r.kt)("p",null,"For more details visit the ",(0,r.kt)("a",{parentName:"p",href:"/argo-messaging/docs/api_advanced/api_subscriptions"},"API Subscriptions")," to see all possible actions for Subscriptions."),(0,r.kt)("h2",{id:"create-users-for-the-new-resources"},"Create users for the new resources"),(0,r.kt)("p",null,"Usually a project will have also publisher and consumer accounts for clients that either are authorized to publish or consume messages. The user ",(0,r.kt)("inlineCode",{parentName:"p"},"demo_service_admin")," can create a ",(0,r.kt)("inlineCode",{parentName:"p"},"publisher_DEMO")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"consumer_DEMO")," for project ",(0,r.kt)("inlineCode",{parentName:"p"},"DEMO")," as such:"),(0,r.kt)("p",null,"To create the ",(0,r.kt)("inlineCode",{parentName:"p"},"publisher_DEMO")," user:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST https://{URL}/v1/users/publisher_DEMO?key=904c56cc6e2b1955dbd98ace80a45be8238432fc\n")),(0,r.kt)("p",null,"with POST Body:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "email":"demopublisher@mail.example.foo",\n   "projects":[{"project":"DEMO","roles":["publisher"]}]\n}\n')),(0,r.kt)("p",null,"resulting in response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "projects": [\n    {\n      "project": "DEMO",\n      "roles": [\n        "publisher"\n      ]\n    }\n  ],\n  "name": "publisher_DEMO",\n  "token": "915dff62846dd1d790b4296c034c184fa3a859b6",\n  "email": "demopublisher@mail.example.foo",\n  "service_roles": [],\n  "created_on": "2016-10-13T12:39:07Z",\n  "modified_on": "2016-10-13T12:39:07Z",\n  "created_by" : "demo_service_admin"\n}\n')),(0,r.kt)("p",null,"To create the ",(0,r.kt)("inlineCode",{parentName:"p"},"consumer_DEMO")," user:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST https://{URL}/v1/users/consumer_DEMO?key=904c56cc6e2b1955dbd98ace80a45be8238432fc\n")),(0,r.kt)("p",null,"with POST Body:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "email":"democonsumer@mail.example.foo",\n   "projects":[{"project":"DEMO","roles":["consumer"]}]\n}\n')),(0,r.kt)("p",null,"resulting in response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "projects": [\n    {\n      "project": "DEMO",\n      "roles": [\n        "consumer"\n      ]\n    }\n  ],\n  "name": "consumer_DEMO",\n  "token": "dba38fd1a45337a617a59e7278c756f23642e9e7",\n  "email": "democonsumer@mail.example.foo",\n  "service_roles": [],\n  "created_on": "2016-10-13T12:40:07Z",\n  "modified_on": "2016-10-13T12:40:07Z",\n  "created_by" : "demo_service_admin"\n}\n')),(0,r.kt)("p",null,"For more details visit the ",(0,r.kt)("a",{parentName:"p",href:"/argo-messaging/docs/api_advanced/api_users"},"API Users")," to see all possible actions for users."),(0,r.kt)("h3",{id:"modify-topic-acl-to-give-access-to-publisher"},"Modify topic ACL to give access to publisher"),(0,r.kt)("p",null,"In order to give access to user ",(0,r.kt)("inlineCode",{parentName:"p"},"publisher_DEMO")," to topic ",(0,r.kt)("inlineCode",{parentName:"p"},"topic101"),", the user ",(0,r.kt)("inlineCode",{parentName:"p"},"admin_DEMO")," must modify the topic's ACL as such:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST https://{URL}/v1/projects/DEMO/topics/topic101:modifyAcl?key=6311196665befcc1523b8e013979347b8780254c\n")),(0,r.kt)("p",null,"with POST body:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "authorized_users":["publisher_DEMO"]\n}\n')),(0,r.kt)("p",null,"and empty response with ",(0,r.kt)("inlineCode",{parentName:"p"},"200 OK")),(0,r.kt)("p",null,"Now the user ",(0,r.kt)("inlineCode",{parentName:"p"},"publisher_DEMO")," will be authorized to call action ",(0,r.kt)("inlineCode",{parentName:"p"},"topic:publish")," on ",(0,r.kt)("inlineCode",{parentName:"p"},"topic101")," and send messages"),(0,r.kt)("h3",{id:"modify-subscription-acl-to-give-access-to-consumer"},"Modify subscription ACL to give access to consumer"),(0,r.kt)("p",null,"In order to give access to user ",(0,r.kt)("inlineCode",{parentName:"p"},"consumer_DEMO")," to subscription ",(0,r.kt)("inlineCode",{parentName:"p"},"sub101"),", the user ",(0,r.kt)("inlineCode",{parentName:"p"},"admin_DEMO")," must modify the subscription's  ACL as such:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST https://{URL}/v1/projects/DEMO/subscriptions/sub101:modifyAcl?key=6311196665befcc1523b8e013979347b8780254c\n")),(0,r.kt)("p",null,"with POST body:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "authorized_users":["consumer_DEMO"]\n}\n')),(0,r.kt)("p",null,"and empty response with ",(0,r.kt)("inlineCode",{parentName:"p"},"200 OK")),(0,r.kt)("p",null,"Now the user ",(0,r.kt)("inlineCode",{parentName:"p"},"consumer_DEMO")," will be authorized to call action ",(0,r.kt)("inlineCode",{parentName:"p"},"subscription:pull")," on ",(0,r.kt)("inlineCode",{parentName:"p"},"sub101")," and consume messages"))}u.isMDXComponent=!0}}]);