(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{81:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return l}));var a=n(2),r=n(6),i=(n(0),n(93)),o={id:"auth",title:"Authentication & Authorization"},c={unversionedId:"auth",id:"auth",isDocsHomePage:!1,title:"Authentication & Authorization",description:"Security and privacy considerations",source:"@site/docs/auth.md",permalink:"/argo-messaging/docs/auth",sidebar:"someSidebar",previous:{title:"Data flow in Argo Messaging",permalink:"/argo-messaging/docs/msg_flow"},next:{title:"Initial Project & User Management",permalink:"/argo-messaging/docs/projects_users"}},s=[{value:"User Authentication",id:"user-authentication",children:[]},{value:"Authorization",id:"authorization",children:[]},{value:"Per Resource Authorization",id:"per-resource-authorization",children:[]},{value:"GET List ACL of a given topic",id:"get-list-acl-of-a-given-topic",children:[]},{value:"POST Modify ACL of a given topic",id:"post-modify-acl-of-a-given-topic",children:[]},{value:"GET List ACL of a given subscription",id:"get-list-acl-of-a-given-subscription",children:[{value:"Request",id:"request",children:[]},{value:"Where",id:"where",children:[]},{value:"Example request",id:"example-request",children:[]},{value:"Responses",id:"responses",children:[]},{value:"Errors",id:"errors",children:[]}]},{value:"POST Modify ACL of a given subscription",id:"post-modify-acl-of-a-given-subscription",children:[{value:"Request",id:"request-1",children:[]},{value:"Where",id:"where-1",children:[]},{value:"Post data",id:"post-data",children:[]},{value:"Example request",id:"example-request-1",children:[]},{value:"Responses",id:"responses-1",children:[]},{value:"Errors",id:"errors-1",children:[]}]}],b={rightToc:s};function l(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"security-and-privacy-considerations"},"Security and privacy considerations"),Object(i.b)("p",null,"Authentication is the process of determining the identity of a client, which is typically a user account. Authorization is the process of determining what permissions an authenticated identity has on a set of specified resources. In the Messaging API, there can be no authorization without authentication."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"This is an initial implementation of the user authentication and authorization. In the next versions of the ARGO Messaging service we are going to provide support for both bear and OpenID Connect tokens for the API access and it will be possible to apply ACLs at each (resource) subscriptions and topics.")),Object(i.b)("h2",{id:"user-authentication"},"User Authentication"),Object(i.b)("p",null,"Authentication requires the presence of a populated \u201cusers\u201d collection in the datastore in the adhering to the following schema:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n    "name" : "john",\n    "email" : "john@doe.com",\n    "project" : "ARGO",\n    "token" : "S3CR3T",\n    "roles" : [\n        "admin",\n        "member"\n    ]\n}\n')),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Parameter"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"name"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"username")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"email"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"User\u2019s email")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"project"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Project that the user belongs to")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"token"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Secret token for authentication")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"roles"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"List of roles that user has. Each role definition is used in authorization (explained later)")))),Object(i.b)("p",null,"Each user is authenticated by adding the url parameter ?key=T0K3N in each API request"),Object(i.b)("h2",{id:"authorization"},"Authorization"),Object(i.b)("p",null,"Authorization requires the presence of a populated \u201croles\u201d collection in the datastore in the adhering to the following schema:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n    "resource" : "resource_name:action",\n    "roles" : [\n        "admin",\n        "member"\n    ]\n}\n')),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Parameter"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"resource"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Holds the name of the resource and the action on that resource in the following format: resource_name:action")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"roles"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"A list of roles allowed on this resource:action")))),Object(i.b)("p",null,"Resource_name:action must be the same with the default routes supported in the api currently and those are:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Action"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"topics:list"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to list all topics in a project when using  ",Object(i.b)("inlineCode",{parentName:"td"},"GET /projects/PROJECT_A/topics"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"topics:show"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to get information on a specific topic when using ",Object(i.b)("inlineCode",{parentName:"td"},"GET /projects/PROJECT_A/topics/TOPIC_A"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"topics:create"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to create a new topic when using ",Object(i.b)("inlineCode",{parentName:"td"},"PUT /projects/PROJECT_A/topics/TOPIC_NEW"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"topics:delete"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to delete an existing topic when using ",Object(i.b)("inlineCode",{parentName:"td"},"DELETE /projects/PROJECT_A/topics/TOPIC_A"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"topics:publish"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to publish messages in a topic when using ",Object(i.b)("inlineCode",{parentName:"td"},"POST /projects/PROJECT_A/topics/TOPIC_A:publish"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"subscriptions:list"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to list all subscriptions in a project when using ",Object(i.b)("inlineCode",{parentName:"td"},"GET /projects/PROJECT_A/subscriptions"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"subscriptions:show"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to get information on a specific subscription when using ",Object(i.b)("inlineCode",{parentName:"td"},"GET /projects/PROJECT_A/subscriptions/SUB_A"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"subscriptions:create"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to create a new subscription when using ",Object(i.b)("inlineCode",{parentName:"td"},"PUT /projects/PROJECT_A/subscriptions/SUB_NEW"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"subscriptions:delete"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to delete an existing subscription when using ",Object(i.b)("inlineCode",{parentName:"td"},"DELETE /projects/PROJECT_A/subscriptions/SUB_A"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"subscriptions:pull"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to pull messages from a subscription when using ",Object(i.b)("inlineCode",{parentName:"td"},"POST /projects/PROJECT_A/subscriptions/SUB_A:pull"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"subscriptions:acknowledge"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Allow user to acknowledge messages that has pulled when using ",Object(i.b)("inlineCode",{parentName:"td"},"POST /projects/PROJECT_A/subscriptions/SUB_A:acknowledge"))))),Object(i.b)("h2",{id:"per-resource-authorization"},"Per Resource Authorization"),Object(i.b)("p",null,"Messaging API provides the option to control in finer detail access on resources such as topics and subscriptions for users(clients) that are producers or subscribers. Each resource (topic/subscription) comes with an access list (ACL) that contains producers or subscribers that are eligible to use that resource (when publishing or pulling messages respectively). Users with the admin role are able to modify Access lists for topics and subscriptions on the project they belong. In order for the feature to be available Messaging API should have the config parameter ",Object(i.b)("inlineCode",{parentName:"p"},"per_resource_auth")," set to ",Object(i.b)("inlineCode",{parentName:"p"},"true")),Object(i.b)("h2",{id:"get-list-acl-of-a-given-topic"},"[GET]"," List ACL of a given topic"),Object(i.b)("p",null,"Please refer to section ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/argo-messaging/docs/api_topics#get-list-acl-of-a-given-topic"}),"Topics:List ACL of a given topic "),"."),Object(i.b)("h2",{id:"post-modify-acl-of-a-given-topic"},"[POST]"," Modify ACL of a given topic"),Object(i.b)("p",null,"Please refer to section ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/argo-messaging/docs/api_topics#post-modify-acl-of-a-given-topic"}),"Topics:Modify ACL of a given topic "),"."),Object(i.b)("h2",{id:"get-list-acl-of-a-given-subscription"},"[GET]"," List ACL of a given subscription"),Object(i.b)("p",null,"The following request returns a list of authorized users for a given subscription"),Object(i.b)("h3",{id:"request"},"Request"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"GET /v1/projects/{project_name}/subscriptions/{sub_name}:acl")),Object(i.b)("h3",{id:"where"},"Where"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Project_name: Name of the project"),Object(i.b)("li",{parentName:"ul"},"sub_name: name of the subscription")),Object(i.b)("h3",{id:"example-request"},"Example request"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'curl -X POST -H "Content-Type: application/json"  \n-d { POSTDATA } https://{URL}/v1/projects/EGI/subscriptions/monitoring:acl?key=S3CR3T"`\n')),Object(i.b)("h3",{id:"responses"},"Responses"),Object(i.b)("p",null,"Success Response\n",Object(i.b)("inlineCode",{parentName:"p"},"200 OK")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n "authorized_users": [\n  "UserA","UserB"\n ]\n}\n')),Object(i.b)("h3",{id:"errors"},"Errors"),Object(i.b)("p",null,"Please refer to section ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/argo-messaging/docs/api_errors"}),"Errors")," to see all possible Errors"),Object(i.b)("h2",{id:"post-modify-acl-of-a-given-subscription"},"[POST]"," Modify ACL of a given subscription"),Object(i.b)("p",null,"The following request Modifies the authorized users list of a given subscription"),Object(i.b)("h3",{id:"request-1"},"Request"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"POST /v1/projects/{project_name}/subscriptions/{sub_name}:modifyAcl")),Object(i.b)("h3",{id:"where-1"},"Where"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Project_name: Name of the project"),Object(i.b)("li",{parentName:"ul"},"sub_name: name of the subpscription")),Object(i.b)("h3",{id:"post-data"},"Post data"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n"authorized_users": [\n "UserX","UserY"\n]\n}\n')),Object(i.b)("h3",{id:"example-request-1"},"Example request"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'curl -H "Content-Type: application/json"  https://{URL}/v1/projects/EGI/subscriptions/monitoring:modifyAcl?key=S3CR3T"`\n')),Object(i.b)("h3",{id:"responses-1"},"Responses"),Object(i.b)("p",null,"Success Response\n",Object(i.b)("inlineCode",{parentName:"p"},"200 OK")),Object(i.b)("h3",{id:"errors-1"},"Errors"),Object(i.b)("p",null,"If the to-be updated ACL contains users that are non-existent in the project the API returns the following error:\n",Object(i.b)("inlineCode",{parentName:"p"},"404 NOT_FOUND")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n   "error": {\n      "code": 404,\n      "message": "User(s): UserFoo1,UserFoo2 do not exist",\n      "status": "NOT_FOUND"\n   }\n}\n')),Object(i.b)("p",null,"Please refer to section ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/argo-messaging/docs/api_errors"}),"Errors")," to see all possible Errors"))}l.isMDXComponent=!0},93:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return O}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b=r.a.createContext({}),l=function(e){var t=r.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=l(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,b=s(e,["components","mdxType","originalType","parentName"]),p=l(n),d=a,O=p["".concat(o,".").concat(d)]||p[d]||u[d]||i;return n?r.a.createElement(O,c(c({ref:t},b),{},{components:n})):r.a.createElement(O,c({ref:t},b))}));function O(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var b=2;b<i;b++)o[b]=n[b];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);