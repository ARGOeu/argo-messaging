(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{67:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return o})),n.d(t,"default",(function(){return b}));var a=n(2),r=n(6),c=(n(0),n(84)),i={id:"projects_users",title:"Initial Project & User Management"},s={unversionedId:"projects_users",id:"projects_users",isDocsHomePage:!1,title:"Initial Project & User Management",description:"This document describes some of the more advanced setup you may need to do while configuring and deploying the ARGO Messaging Service.",source:"@site/docs/projects_users.md",permalink:"/argo-messaging/docs/projects_users",sidebar:"someSidebar",previous:{title:"Authentication & Authorization",permalink:"/argo-messaging/docs/auth"},next:{title:"Service introduction and configuration",permalink:"/argo-messaging/docs/api_basic"}},o=[{value:"A typical quick-start scenario",id:"a-typical-quick-start-scenario",children:[]},{value:"Configure <code>service_token</code>",id:"configure-service_token",children:[]},{value:"Create a service_admin user",id:"create-a-service_admin-user",children:[]},{value:"Create a project",id:"create-a-project",children:[]},{value:"Create a project_admin",id:"create-a-project_admin",children:[]},{value:"Create a topic",id:"create-a-topic",children:[]},{value:"Create a subscription",id:"create-a-subscription",children:[]},{value:"Create users for the new resources",id:"create-users-for-the-new-resources",children:[{value:"Modify topic ACL to give access to publisher",id:"modify-topic-acl-to-give-access-to-publisher",children:[]},{value:"Modify subscription ACL to give access to consumer",id:"modify-subscription-acl-to-give-access-to-consumer",children:[]}]}],p={rightToc:o};function b(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(c.b)("p",null,"This document describes some of the more advanced setup you may need to do while configuring and deploying the ARGO Messaging Service."),Object(c.b)("h2",{id:"a-typical-quick-start-scenario"},"A typical quick-start scenario"),Object(c.b)("p",null,"After a fresh install of the ARGO Messaging Service, the steps you need to follow are:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Configure ",Object(c.b)("inlineCode",{parentName:"li"},"service_token"),": to enable the service."),Object(c.b)("li",{parentName:"ul"},"Create a service_admin user: to start managing the service."),Object(c.b)("li",{parentName:"ul"},"Create a project: Project entities is used as a basis of organizing and isolating groups of users & resources"),Object(c.b)("li",{parentName:"ul"},"Create a project_admin user: Users that have the project_admin have, by default, all capabilities in their project. They can also manage resources such as topics and subscriptions (CRUD) and also manage ACLs (users) on those resources as well."),Object(c.b)("li",{parentName:"ul"},"Create a topic: The main resource that is scoped in a project, and can hold messages."),Object(c.b)("li",{parentName:"ul"},"Create a subscription: A subscription is the main resource from which users consume messages."),Object(c.b)("li",{parentName:"ul"},"Create users for the new resources: Usually a project has  publisher and consumer accounts for clients that either are authorized to publish or consume messages.")),Object(c.b)("h2",{id:"configure-service_token"},"Configure ",Object(c.b)("inlineCode",{parentName:"h2"},"service_token")),Object(c.b)("p",null,"ARGO Messaging Service configuration includes the ",Object(c.b)("inlineCode",{parentName:"p"},"service_token")," parameter. This ",Object(c.b)("inlineCode",{parentName:"p"},"service_token")," configuration parameter can be used to create the first ",Object(c.b)("inlineCode",{parentName:"p"},"service_admin")," user of the service"),Object(c.b)("p",null,"First a service token must be defined in the config.json as such:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n  "bind_ip":"",\n  "port":8080,\n  "zookeeper_hosts":["localhost"],\n  "kafka_znode":"",\n  "store_host":"localhost",\n  "store_db":"argo_msg",\n  "certificate":"/etc/pki/tls/certs/localhost.crt",\n  "certificate_key":"/etc/pki/tls/private/localhost.key",\n  "per_resource_auth":"true",\n  "service_token":"S3CR3T",\n  "push_enabled": false\n}\n')),Object(c.b)("p",null,"The service token in this example has the value: ",Object(c.b)("inlineCode",{parentName:"p"},"S3CR3T"),"\nThis ",Object(c.b)("inlineCode",{parentName:"p"},"service_token")," is authorized for all available actions (projects,users,topics,subscriptions)."),Object(c.b)("p",null,"In order to enable the use of this ",Object(c.b)("inlineCode",{parentName:"p"},"service_token")," you must restart the service."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"service argo-messaging restart\n")),Object(c.b)("h2",{id:"create-a-service_admin-user"},"Create a service_admin user"),Object(c.b)("p",null,"The service_token is intended to be used for the first initialization of the API. The first thing the service needs is a user with all possible capabilities, which is a ",Object(c.b)("inlineCode",{parentName:"p"},"service_admin"),".\nNow even though no user has been initialized in the service, the administrator can use the ARGO Messaging API Call with service_token ",Object(c.b)("inlineCode",{parentName:"p"},"S3CR3T")," to create the user.\nThe service_admin will be able to further define projects and other users."),Object(c.b)("p",null,"Using the service_token an admin can create a new service_admin user with the username ",Object(c.b)("inlineCode",{parentName:"p"},"demo_service_admin")," by calling:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"POST https://{URL}/v1/users/demo_service_admin?key=S3CR3T\n")),Object(c.b)("p",null,"with the following POST BODY:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n   "email":"sadmin@mail.example.foo",\n   "service_roles":["service_admin"]\n}\n')),Object(c.b)("p",null,"It is important to mention that the user has the ",Object(c.b)("strong",{parentName:"p"},'"service_admin"')," role defined in the service_roles list in order to be a service_admin."),Object(c.b)("p",null,"The response:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "projects": [],\n  "name": "demo_service_admin",\n  "token": "904c56cc6e2b1955dbd98ace80a45be8238432fc",\n  "email": "sadmin@mail.example.foo",\n  "service_roles": [\n    "service_admin"\n  ],\n  "created_on": "2016-10-13T11:19:07Z",\n  "modified_on": "2016-10-13T11:19:07Z"\n}\n')),Object(c.b)("p",null,"The generated token ",Object(c.b)("inlineCode",{parentName:"p"},"904c56cc6e2b1955dbd98ace80a45be8238432fc")," can be used to authenticate the new user.\nFor more details visit the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"/argo-messaging/docs/api_users"}),"API Users")," to see all possible actions for users."),Object(c.b)("h2",{id:"create-a-project"},"Create a project"),Object(c.b)("p",null,"Using the ",Object(c.b)("inlineCode",{parentName:"p"},"demo_service_admin")," account, the user can create the first project (ex named 'DEMO') by issuing:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"POST https://{URL}/v1/projects/DEMO?key=904c56cc6e2b1955dbd98ace80a45be8238432fc\n")),Object(c.b)("p",null,"with the following POST BODY:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n   "description":"my first demo project"\n}\n')),Object(c.b)("p",null,"and the response:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "name": "DEMO",\n  "created_on": "2016-10-13T12:19:07Z",\n  "modified_on": "2016-10-13T12:19:07Z",\n  "created_by": "demo_service_admin",\n  "description": "my first demo project"\n}\n')),Object(c.b)("p",null,"Response informs that the project has been indeed ",Object(c.b)("inlineCode",{parentName:"p"},"created_by")," the ",Object(c.b)("inlineCode",{parentName:"p"},"demo_service_admin")," user."),Object(c.b)("p",null,"For more details visit the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"/argo-messaging/docs/api_projects"}),"API Projects")," to see all possible actions for projects."),Object(c.b)("h2",{id:"create-a-project_admin"},"Create a project_admin"),Object(c.b)("p",null,"Service_admin users are not attached to specific projects. Instead each project should have a ",Object(c.b)("inlineCode",{parentName:"p"},"project_admin")," user that will manage topics, subscriptions and ACLs on those resources. To create a ",Object(c.b)("inlineCode",{parentName:"p"},"project_admin")," user in project ",Object(c.b)("inlineCode",{parentName:"p"},"DEMO"),", the user ",Object(c.b)("inlineCode",{parentName:"p"},"demo_service_admin")," will issue:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"POST https://{URL}/v1/users/admin_DEMO?key=904c56cc6e2b1955dbd98ace80a45be8238432fc\n")),Object(c.b)("p",null,"with the following POST BODY:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n   "email":"demoadmin@mail.example.foo",\n   "projects":[{"project":"DEMO","roles":["project_admin"]}]\n}\n')),Object(c.b)("p",null,"The user definition (in POST body) should have the field ",Object(c.b)("inlineCode",{parentName:"p"},"projects")," defined. The field accepts a list of tuple items (project,roles) which describe each project that the user participates to and under which roles. A user can have multiple roles in a project and also participate in multiple projects as well. In this example, the user must participate in project ",Object(c.b)("inlineCode",{parentName:"p"},"DEMO")," and under the role of ",Object(c.b)("inlineCode",{parentName:"p"},"project_admin"),"."),Object(c.b)("p",null,"The response:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "projects": [\n    {\n      "project": "DEMO",\n      "roles": [\n        "project_admin"\n      ]\n    }\n  ],\n  "name": "admin_DEMO",\n  "token": "6311196665befcc1523b8e013979347b8780254c",\n  "email": "demoadmin@mail.example.foo",\n  "service_roles": [],\n  "created_on": "2016-10-13T12:29:07Z",\n  "modified_on": "2016-10-13T12:29:07Z",\n  "created_by": "demo_service_admin"\n}\n')),Object(c.b)("p",null,"For more details visit the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"/argo-messaging/docs/api_users"}),"API Users")," to see all possible actions for users."),Object(c.b)("h2",{id:"create-a-topic"},"Create a topic"),Object(c.b)("p",null,"Service_admin users don't manage resources such as topics/subscriptions. Instead in each project the project_admin is eligible for creating (and managing) topics and subscriptions. To create a new topic (named ",Object(c.b)("inlineCode",{parentName:"p"},"topic101"),") as ",Object(c.b)("inlineCode",{parentName:"p"},"admin_DEMO")," user in project ",Object(c.b)("inlineCode",{parentName:"p"},"DEMO")," the user issues:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"PUT https://{URL}/v1/projects/DEMO/topics/topic101?key=6311196665befcc1523b8e013979347b8780254c\n")),Object(c.b)("p",null,"with response:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n  "name": "/projects/DEMO/topics/topic101"\n}\n')),Object(c.b)("p",null,"Notice that the token used in api ",Object(c.b)("inlineCode",{parentName:"p"},"key")," changes to that of the ",Object(c.b)("inlineCode",{parentName:"p"},"admin_DEMO")," user"),Object(c.b)("p",null,"For more details visit the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"/argo-messaging/docs/api_topics"}),"API Topics")," to see all possible actions for topics."),Object(c.b)("h2",{id:"create-a-subscription"},"Create a subscription"),Object(c.b)("p",null,"To create a new subscription (named ",Object(c.b)("inlineCode",{parentName:"p"},"sub101"),") to topic ",Object(c.b)("inlineCode",{parentName:"p"},"topic101")," of project ",Object(c.b)("inlineCode",{parentName:"p"},"DEMO")," the ",Object(c.b)("inlineCode",{parentName:"p"},"admin_DEMO")," user issues:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"PUT https://{URL}/v1/projects/DEMO/subscriptions/subs101?key=6311196665befcc1523b8e013979347b8780254c\n")),Object(c.b)("p",null,"with POST Body:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n   "topic":"projects/DEMO/topic/topic101"\n}\n')),Object(c.b)("p",null,"and response:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "name": "/projects/DEMO/subscriptions/sub101",\n  "topic": "/projects/DEMO/topics/topic101",\n  "pushConfig": {\n    "pushEndpoint": "",\n    "retryPolicy": {}\n  },\n  "ackDeadlineSeconds": 10\n}\n')),Object(c.b)("p",null,"For more details visit the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"/argo-messaging/docs/api_subscriptions"}),"API Subscriptions")," to see all possible actions for Subscriptions."),Object(c.b)("h2",{id:"create-users-for-the-new-resources"},"Create users for the new resources"),Object(c.b)("p",null,"Usually a project will have also publisher and consumer accounts for clients that either are authorized to publish or consume messages. The user ",Object(c.b)("inlineCode",{parentName:"p"},"demo_service_admin")," can create a ",Object(c.b)("inlineCode",{parentName:"p"},"publisher_DEMO")," and ",Object(c.b)("inlineCode",{parentName:"p"},"consumer_DEMO")," for project ",Object(c.b)("inlineCode",{parentName:"p"},"DEMO")," as such:"),Object(c.b)("p",null,"To create the ",Object(c.b)("inlineCode",{parentName:"p"},"publisher_DEMO")," user:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"POST https://{URL}/v1/users/publisher_DEMO?key=904c56cc6e2b1955dbd98ace80a45be8238432fc\n")),Object(c.b)("p",null,"with POST Body:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n   "email":"demopublisher@mail.example.foo",\n   "projects":[{"project":"DEMO","roles":["publisher"]}]\n}\n')),Object(c.b)("p",null,"resulting in response:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "projects": [\n    {\n      "project": "DEMO",\n      "roles": [\n        "publisher"\n      ]\n    }\n  ],\n  "name": "publisher_DEMO",\n  "token": "915dff62846dd1d790b4296c034c184fa3a859b6",\n  "email": "demopublisher@mail.example.foo",\n  "service_roles": [],\n  "created_on": "2016-10-13T12:39:07Z",\n  "modified_on": "2016-10-13T12:39:07Z",\n  "created_by" : "demo_service_admin"\n}\n')),Object(c.b)("p",null,"To create the ",Object(c.b)("inlineCode",{parentName:"p"},"consumer_DEMO")," user:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"POST https://{URL}/v1/users/consumer_DEMO?key=904c56cc6e2b1955dbd98ace80a45be8238432fc\n")),Object(c.b)("p",null,"with POST Body:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n   "email":"democonsumer@mail.example.foo",\n   "projects":[{"project":"DEMO","roles":["consumer"]}]\n}\n')),Object(c.b)("p",null,"resulting in response:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "projects": [\n    {\n      "project": "DEMO",\n      "roles": [\n        "consumer"\n      ]\n    }\n  ],\n  "name": "consumer_DEMO",\n  "token": "dba38fd1a45337a617a59e7278c756f23642e9e7",\n  "email": "democonsumer@mail.example.foo",\n  "service_roles": [],\n  "created_on": "2016-10-13T12:40:07Z",\n  "modified_on": "2016-10-13T12:40:07Z",\n  "created_by" : "demo_service_admin"\n}\n')),Object(c.b)("p",null,"For more details visit the ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"/argo-messaging/docs/api_users"}),"API Users")," to see all possible actions for users."),Object(c.b)("h3",{id:"modify-topic-acl-to-give-access-to-publisher"},"Modify topic ACL to give access to publisher"),Object(c.b)("p",null,"In order to give access to user ",Object(c.b)("inlineCode",{parentName:"p"},"publisher_DEMO")," to topic ",Object(c.b)("inlineCode",{parentName:"p"},"topic101"),", the user ",Object(c.b)("inlineCode",{parentName:"p"},"admin_DEMO")," must modify the topic's ACL as such:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"POST https://{URL}/v1/projects/DEMO/topics/topic101:modifyAcl?key=6311196665befcc1523b8e013979347b8780254c\n")),Object(c.b)("p",null,"with POST body:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n   "authorized_users":["publisher_DEMO"]\n}\n')),Object(c.b)("p",null,"and empty response with ",Object(c.b)("inlineCode",{parentName:"p"},"200 OK")),Object(c.b)("p",null,"Now the user ",Object(c.b)("inlineCode",{parentName:"p"},"publisher_DEMO")," will be authorized to call action ",Object(c.b)("inlineCode",{parentName:"p"},"topic:publish")," on ",Object(c.b)("inlineCode",{parentName:"p"},"topic101")," and send messages"),Object(c.b)("h3",{id:"modify-subscription-acl-to-give-access-to-consumer"},"Modify subscription ACL to give access to consumer"),Object(c.b)("p",null,"In order to give access to user ",Object(c.b)("inlineCode",{parentName:"p"},"consumer_DEMO")," to subscription ",Object(c.b)("inlineCode",{parentName:"p"},"sub101"),", the user ",Object(c.b)("inlineCode",{parentName:"p"},"admin_DEMO")," must modify the subscription's  ACL as such:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"POST https://{URL}/v1/projects/DEMO/subscriptions/sub101:modifyAcl?key=6311196665befcc1523b8e013979347b8780254c\n")),Object(c.b)("p",null,"with POST body:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n   "authorized_users":["consumer_DEMO"]\n}\n')),Object(c.b)("p",null,"and empty response with ",Object(c.b)("inlineCode",{parentName:"p"},"200 OK")),Object(c.b)("p",null,"Now the user ",Object(c.b)("inlineCode",{parentName:"p"},"consumer_DEMO")," will be authorized to call action ",Object(c.b)("inlineCode",{parentName:"p"},"subscription:pull")," on ",Object(c.b)("inlineCode",{parentName:"p"},"sub101")," and consume messages"))}b.isMDXComponent=!0},84:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=r.a.createContext({}),b=function(e){var t=r.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},l=function(e){var t=b(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,c=e.originalType,i=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),l=b(n),d=a,m=l["".concat(i,".").concat(d)]||l[d]||u[d]||c;return n?r.a.createElement(m,s(s({ref:t},p),{},{components:n})):r.a.createElement(m,s({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var c=n.length,i=new Array(c);i[0]=d;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<c;p++)i[p]=n[p];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);